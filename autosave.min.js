!function(){var e,t,n,a,o,r,i,l=window.autosaveInterval||10,u=window.autosaveLifetime||18e3,c="linkform",s="lf_url",d="autosave_",m=!0,v=document.getElementById("shaarli-autosave"),y=document.querySelector("#shaarli-autosave p"),f=document.getElementById("shaarli-autosave-restore"),g=document.getElementById("shaarli-autosave-discard");function h(){return(new Date).getTime()}function S(){var e={},t=document.querySelectorAll("[name=linkform] [name]");for(var n in t){var a=t[n].name;["save_edit","cancel_edit","delete_link","token","returnurl"].indexOf(a)<0&&("string"==typeof a&&0<a.length&&("checkbox"===t[n].type?e[a]=t[n].checked:"radio"===t[n].type&&!t[n].checked||(e[a]=t[n].value)),e[a]&&e[a])}return e}function p(){return d+document.querySelector("[name="+s+"]").value}function k(){return localStorage.hasOwnProperty(p())}function w(e){if(e=e||p(),k())return JSON.parse(localStorage.getItem(e))}function _(){var e,t;m?((e=S())._autosaveTime=h(),"string"==typeof(t=p())&&t.length>d.length&&"object"==typeof e&&(localStorage.setItem(t.trim(),JSON.stringify(e)),b("Content saved.")),function(){for(key in localStorage){var e;0===key.indexOf(d)&&(e=w(key),h()-e._autosaveTime>u&&(localStorage.removeItem(key),b("Key "+key+" removed.")))}}()):b("Save was temporarily disabled until you decide what to do with previously saved content.")}function b(e){console.log("Shaarli Autosave: "+e)}b("Initializing Shaarli Autosave..."),l*=1e3,u*=1e3,document.querySelector("[name="+c+"]")&&document.querySelector("[name="+s+"]")?(k()&&(b("Previously saved content found for this link!"),e=w(),n=(t=new Date(e._autosaveTime)).toLocaleDateString()+" "+t.toLocaleTimeString(),o=null,(a=window.moment||null)&&(o=a(t).fromNow()),r=w(),i=S(),delete r._autosaveTime,delete i.item,JSON.stringify(r)!==JSON.stringify(i)&&(m=!1,y.innerHTML="An existing draft from <strong>"+n+(o?" ("+o+")":"")+"</strong> has been found for this link. Do you want to load it? Otherwise, this draft will be completely erased. <br>Saving is paused until you take a decision.",v.style.display="block",f.addEventListener("click",function(){!function(){var e=document.querySelectorAll("[name="+c+"] [name]"),t=w();if(t)for(var n in e){var a=e[n],o=a.name;t.hasOwnProperty(o)&&("checkbox"===a.type?a.checked=t[o]:"radio"===a.type?a.value===t[o]&&(a.checked=!0):a.value=t[o])}}(),m=!0,v.style.display="none"}),g.addEventListener("click",function(){m=!0,v.style.display="none"}))),setInterval(function(){_()},l),document.querySelector("[name="+c+"]").addEventListener("submit",function(){_()}),window.onbeforeunload=function(){_()}):console.error("Shaarli autosave plugin has incorrect parameters. Try removing parameters autosave_FORMNAME and autosave_KEYNAME via the plugin administration.")}();